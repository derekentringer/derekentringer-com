generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([expiresAt])
  @@map("refresh_tokens")
}

model Account {
  id              String        @id @default(cuid())
  name            String
  type            String
  institution     String
  accountNumber   String?
  currentBalance  String
  estimatedValue  String?
  interestRate    String?
  csvParserId     String?
  originalBalance String?
  originationDate String?
  maturityDate    String?
  loanType        String?
  employerName    String?
  isActive                Boolean       @default(true)
  isFavorite              Boolean       @default(false)
  excludeFromIncomeSources Boolean      @default(false)
  dtiPercentage   Int           @default(100)
  sortOrder       Int           @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  transactions    Transaction[]
  balances        Balance[]
  bills           Bill[]

  @@index([isActive])
  @@index([sortOrder])
  @@map("accounts")
}

model Transaction {
  id          String   @id @default(cuid())
  accountId   String
  date        DateTime
  description String
  amount      String
  category    String?
  notes       String?
  dedupeHash  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  account     Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@unique([accountId, dedupeHash])
  @@index([accountId])
  @@index([date])
  @@index([date, accountId])
  @@map("transactions")
}

model Category {
  id        String   @id @default(cuid())
  name      String   @unique
  isDefault Boolean  @default(false)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sortOrder])
  @@map("categories")
}

model CategoryRule {
  id        String   @id @default(cuid())
  pattern   String
  matchType String
  category  String
  priority  Int      @default(100)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([priority])
  @@map("category_rules")
}

model Balance {
  id                String              @id @default(cuid())
  accountId         String
  balance           String
  date              DateTime
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  account           Account             @relation(fields: [accountId], references: [id], onDelete: Cascade)
  loanProfile       LoanProfile?
  investmentProfile InvestmentProfile?
  savingsProfile    SavingsProfile?
  creditProfile     CreditProfile?

  @@index([accountId, date])
  @@index([accountId])
  @@index([date])
  @@map("balances")
}

model LoanProfile {
  id                  String   @id @default(cuid())
  balanceId           String   @unique
  periodStart         String?
  periodEnd           String?
  interestRate        String?
  monthlyPayment      String?
  principalPaid       String?
  interestPaid        String?
  escrowAmount        String?
  nextPaymentDate     String?
  remainingTermMonths String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  balance             Balance  @relation(fields: [balanceId], references: [id], onDelete: Cascade)

  @@map("loan_profiles")
}

model InvestmentProfile {
  id            String   @id @default(cuid())
  balanceId     String   @unique
  periodStart   String?
  periodEnd     String?
  rateOfReturn  String?
  ytdReturn     String?
  totalGainLoss String?
  contributions String?
  employerMatch String?
  vestingPct    String?
  fees          String?
  expenseRatio  String?
  dividends     String?
  capitalGains  String?
  numHoldings   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  balance       Balance  @relation(fields: [balanceId], references: [id], onDelete: Cascade)

  @@map("investment_profiles")
}

model SavingsProfile {
  id                String   @id @default(cuid())
  balanceId         String   @unique
  periodStart       String?
  periodEnd         String?
  apy               String?
  interestEarned    String?
  interestEarnedYtd String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  balance           Balance  @relation(fields: [balanceId], references: [id], onDelete: Cascade)

  @@map("savings_profiles")
}

model CreditProfile {
  id              String   @id @default(cuid())
  balanceId       String   @unique
  periodStart     String?
  periodEnd       String?
  apr             String?
  minimumPayment  String?
  creditLimit     String?
  availableCredit String?
  interestCharged String?
  feesCharged     String?
  rewardsEarned   String?
  paymentDueDate  String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  balance         Balance  @relation(fields: [balanceId], references: [id], onDelete: Cascade)

  @@map("credit_profiles")
}

model Budget {
  id            String   @id @default(cuid())
  category      String
  amount        String
  effectiveFrom String
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([category, effectiveFrom])
  @@index([category, effectiveFrom])
  @@map("budgets")
}

model Bill {
  id         String        @id @default(cuid())
  name       String
  amount     String
  frequency  String
  dueDay     Int
  dueMonth   Int?
  dueWeekday Int?
  category   String?
  accountId  String?
  notes      String?
  isActive   Boolean       @default(true)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  account    Account?      @relation(fields: [accountId], references: [id], onDelete: SetNull)
  payments   BillPayment[]

  @@index([isActive])
  @@map("bills")
}

model IncomeSource {
  id        String   @id @default(cuid())
  name      String
  amount    String
  frequency String
  isActive  Boolean  @default(true)
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
  @@map("income_sources")
}

model BillPayment {
  id       String   @id @default(cuid())
  billId   String
  dueDate  DateTime
  paidDate DateTime @default(now())
  amount   String
  bill     Bill     @relation(fields: [billId], references: [id], onDelete: Cascade)

  @@unique([billId, dueDate])
  @@index([billId])
  @@index([dueDate])
  @@map("bill_payments")
}

model DeviceToken {
  id        String   @id @default(cuid())
  token     String   @unique
  platform  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([platform])
  @@map("device_tokens")
}

model NotificationPreference {
  id        String   @id @default(cuid())
  type      String   @unique
  enabled   Boolean  @default(true)
  config    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("notification_preferences")
}

model NotificationLog {
  id           String   @id @default(cuid())
  type         String
  title        String
  body         String
  dedupeKey    String   @unique
  isRead       Boolean  @default(false)
  sentAt       DateTime @default(now())
  fcmMessageId String?
  metadata     String?

  @@index([type])
  @@index([sentAt])
  @@index([isRead])
  @@map("notification_logs")
}
